# 目标
- `vi` 简介
- 打开和新建文件
- 三种工作模式
- 常用命令
- 常用命令速查

# 01. vi简介
## 1.1 学习vi的目的
- 在工作中，要对 **服务器** 上的文件进行 **简单** 的修改， 可以使用 `ssh` 远程登录到服务器上，并使用 `vi` 进行快速的编辑即可
- 常见需要要修改的文件包括：
  - **源程序**
  - **配置文件**，例如`ssh`的配置文件`~/.ssh/config`
> - 在没有图形界面的环境下，要编辑文件，`vi`是最佳选择！
> - 每一个要使用Linux的程序员，都应该或多或少的学习一些`vi`常用命令 
## 1.2 vi和vim
- 在很多`Linux`发行版中，直接把`vi`做成 `vim`的软链接
### vi
- `vi`是`Visual interface`的简称，是`Linux`中**最经典**的文本编辑器
- `vi`的设计核心思想--**让程序员的手指始终保持在键盘的核心区域，就能完成所有的编辑操作**
- `vi`的特点：
  - **没有图形界面**的**功能强大**的编辑器
  - 只能是编辑**文本内容**，不能对字体、段落进行排版
  - 没有菜单
  - 只有命令
- `vi`编辑器在`系统管理、服务器管理`编辑文件时，**其功能永远不是图形界面的编辑器能比拟的**
### vim
**vim=vi improved**
- `vim`是从`vi`发展出来的一个文本编辑器，支持`代码补全`、`编译`及`错误跳转`等方便编程的功能特别丰富，在程序员中被广泛使用，被称为**编辑器之神**
**vim 安装**
```
apt get install vim
```
# 02.打开和新建文件
- 在终端输入`vi`**在后面跟上文件名**即可
```
vi 文件名
```
- 如果文件已经存在，会直接打开文件夹
- 如果文件不存在，会新建一个文件夹
## 2.1打开文件并且定位行
- 在日常工作中，可能会遇到**打开一个文件、并定位到指定行**的情况
- 例如：在开发时，**知道某一行代码有错误**，可以**快速定位**到出错代码的位置
- 这个时候，可以使用以下命令打开文件
```
vi 文件名 +行数
```
> *提示：如果只带上`+`而不指定行号，会直接定位到文件末尾*

vim显示行数
```
vim使用命令set number
```
这样设置只是一次有效，如果每次有效，需要编辑vim的配置文件，在其中加入一行：`set number`
```
sudo vim /etc/vim/vimrc
```
## 2.2异常处理
- 如果`vi`异常退出，在磁盘上可能会保存有交换文件
- 下次使用`vi`编辑该文件时，会看到以下屏幕信息，按下字母`d`可以**删除交换文件**即可
> *提示：按下键盘时，注意关闭输入法*
![搜狗截图20220305071712](https://user-images.githubusercontent.com/12490550/156854821-87072c30-5c72-4a19-8100-f4cdafd0572a.png)
# 03.三种工作模式
- `vi`有三种基本工作模式：
  1. **0.1命令模式**
    - **打开文件首先进入命令模式**，是使用`vi`的**入口**

    - 通过**命令**对文件进行常规的编辑操作，例如**定位**、**翻页**、**复制**、**粘贴**、**删除**…………
    - 在其他图形编辑器下，通过**快捷键**或者**鼠标**实现的操作，都在**命令模式**下实现
  2. **02.末行模式**--执行**保存、退出**等操作
    - 要退出`vi`返回到控制台，需要在末行模式下输入命令
    - **末行模式**是`vi`的**出口**
  3. **编辑模式**--正常的编辑文字
![image](https://user-images.githubusercontent.com/12490550/156856171-9859d91c-ccb6-44aa-82f7-7c2f5de03798.png)
> *提示`Touch Bar`的Mac电脑上，按`Esc`不方便，可以用`Ctrl+[`替代*
## 末行命令模式
|命令|英文|功能|
|---|---|---|
|w|write|保存|
|q|quit|退出，没有保存，不允许退出|
|q!|quit|强行退出、不保存退出|
|wq|write & quit|保存并退出|
|x||保存并退出|
# 常用命令
## 命令路线图
1. 重复次数
    - 在命令模式下，**先输入一个数字，再跟上一个数字**，可以让该命令**重复执行指定次数**
2. 移动和选择**（多练）**
    - `vi`之所以快，关键在于**能够快速定位到要编辑的代码行**
    - **移动命令**能够和**编辑操作**命令**组合使用**
3. 编辑操作
    - **删除、复制、粘贴、替换、缩排**
4. 撤销和重复
5. 查找替换
6. 编辑
### 学习提示
1. `vi`的命令较多，**不要期望一下子全部记住**，个别命令忘记了，只是会影响编辑速度而已
2. 在使用`vi`命令时，注意**关闭中文输入法**
## 4.1移动（基本）
- 要熟练使用`vi`，首先应该学会怎么在**命令模式**下快速移动光标
- **编辑操作命令**，能够和**移动命令**结合在一起使用
### 1)上、下、左、右
|命令|功能|手指|
|---|---|---|
|h|向左|食指|
|j|向下|食指|
|k|向上|中值|
|l|向右|无名指|
### 2)行内移动
|命令|英文|功能|
|---|---|---|
|w|word|向后移动一个单词|
|b|back|向前移动一个单词|
|0||行首|
|^||行首，第一个不是空白字符的位置|
|$||行位|
### 3)行数移动
|命令|英文|功能|
|----|----|---|
|gg|go|文件顶部|
|G|go|文件末尾|
|数字gg|go|移动到 数字 对应行数|
|数字G|go|移动到 数字 对应行数|
|:数字||移动到 数字 对应行数|
### 4)屏幕移动
|命令|英文|功能|
|---|---|---|
|Ctrl+b|back|向上翻页|
|Ctrl+f|forward|向下翻页|
|H|Head|屏幕顶部|
|M|Middle|屏幕中间|
|L|Low|屏幕底部|
## 4.2移动（程序）
### 1)段落移动
- `vi`中使用 空行来区分段落
- 在程序开发时，通常`一段代码能相关的代码写在一起`--之间没有空行
|命令|功能|
|---|---|
|{|上一段|
|}|下一段|
### 2)括号切换
- 在程序员世界中，`()`、`[]`、`{}`使用频率很高，而且**都是成对出现的**
|命令|功能|
|---|---|
|%|括号匹配及切换|
### 3)
- 在开发时，某一块代码可能**需要稍后处理**，例如：编辑、查看
- 此事先使用`m`增加一个标记，这样可以**在需要时快速地跳转回来**或者**执行其他编辑操作**
- **编辑名称**可以是`a~z`或者`A~Z`之间的任意**一个**字母
- 添加了标记的**行如果被删除，标记同时被删除**
- 如果`在其他行添加了相同名称的标记，之前添加的标记也会被替换掉`
|命令|英文|功能|
|mx|mark|添加标记x，x是a~z或者A~Z之间的任意一个字母|
|'x||直接定位到标记x所在的位置|
## 4.3选中文本（可视模式）
- 学习`复制`命令前，应该先学会**怎么样选中要复制的代码**
- 在`vi`中要选择文本，首先使用`Visual`命令切换到**可视模式**
- `vi`中提供了**三种**可视模式，可以方便程序员选择**选中文本的方式**
- 按`ESC`可以放弃选中，返回到`命令模式`
|命令|模式|功能|
|---|---|---|
|v|可视模式|从光标位置开始按照正常模式选择文本|
|V|可视模式|选中光标经过的完整行|
|Ctrl+v|可视块模式|垂直方向选中文本|
- **可视模式**下，可以和**移动命令**连用，例如：`ggVG`能够选中所有内容
## 4.4撤销和恢复撤销
- 在学习编辑命令之前，先要知道怎样撤销之前一次 **错误的**编辑动作！
|命令|英文|功能|
|---|---|---|
|u|undo|撤销上一次命令|
|Ctrl+r|redo|恢复撤销的命令|
## 4.5删除文本
|命令|英文|功能|
|---|---|---|
|x|cut|删除光标所在字符，或者选中文字|
|d（移动命令）|delete|删除移动命令对应的内容|
|dd|delete|删除光标所在行，可以ndd删除多行|
|D|delete|删除至行尾|
> 提示：如果使用**可视模式**已经选中了一段文本，那么无论使用`d`还是`x`，都可以删除选中文本
- 删除命令可以和**移动命令**连用，以下是常见的组合命令：
```
dw		#从光标位置删除到单词末尾
d0		#从光标位置删除到一行的起始位置
d}		#从光标位置删除到段落结尾
ndd		#从光标位置向下连续删除n行
d代码行G		#从光标所在行 删除到 指定代码行 值钱的所有代码
d'a		#从光标所在行 删除到 标记a 之前的所有代码
```
## 4.6复制、粘贴
- `vi`中提供一个**被复制文本的缓冲区**
    - **复制**命令会将选中的文字保存在缓冲区
    - **删除**命令删除的文字会被保存在缓冲区
    - 在需要的位置，使用**粘贴**命令可以将缓冲区的文字插入到光标所在位置
|命令|英文|功能|
|---|---|---|
|y(移动命令)|copy|复制|
|yy|copy|复制一行，可以nyy复制多行|
|p|paste|粘贴|
### 提示
- 命令`d`、`x`类似于图形界面的`剪切操作`——`Ctrl+X`
- 命令`y`类似于图形界面的**复制操作**——`Ctrl+C`
- 命令`p`类似于图形界面的**粘贴操作**——`Ctrl+V`
- `vi`中的`文本缓冲区同样只有一个`，如果后续做过**复制、剪切**操作，之前缓冲区的内容会被替换
### 注意
- `vi`中的`文本缓冲区`和系统的**剪切板**不是同一个
- 所以在其他软件中使用`Ctrl+C`复制的内容，不能在`vi`中通过`p`命令粘贴
- 可以在**编辑模式**下使用**鼠标右键粘贴**
## 4.7替换
|命令|英文|功能|工作模式|
|---|---|---|---|
|r|replace|替换当前字符|命令模式|
|R|replace|替换当前行光标后的字符|替换模式|
- `R`命令可以进入`替换模式`，替换完成后，按下`Esc`可以回到**命令模式**
- **替换命令**的作用就是不进入**编辑模式**，对文件进行**轻量级的修改**
## 4.8锁排和重复执行
|命令|功能|
|---|---|
|>>|向右增加缩进|
|<<|向左减少缩进|
|.|重复上一次命令|
- **缩进命令**在开发程序时，**统一增加代码的缩进**比较有用！
	- 一次性**在选中代码前增加4个空格**，就叫**增加缩进**
    - 一次性**在选中代码前删除4个空格**，就叫**减少缩进**
- 在**课是模式**下，缩排命令只要使用**一个**`>`或者`<`
> 在程序中，**缩进**通常用来表示代码的归属关系
> - 前面空格越少，代码的级别越高
> - 前面空格越多，代码的级别越低
## 4.9查找
### 常规查找
|命令|功能|
|---|---|
|/str|查找str|
- 查找到制定内容之后，使用`Next`查找下一个出现的位置：
	- `n`：查找下一个
	- `N`：查找上一个
- 如果不想看到高亮显示，可以随便查找一个文件中不存在的内容即可
### 单词快速匹配
|命令|功能|
|---|---|
|\*|向后查找当前光标所在单词|
|#|向前查找当前光标所在单词|
- 在开发中，通过单词快速匹配，可以快速看到这个单词在其他什么位置使用过
## 4.10
- 在`vi`中查找和替换命令需要在**末行模式**下执行
- 记忆命令格式：
```
:%s///g
```
### 1)全局替换
- **一次性**替换文件中**所有出现的旧文本**
- 命令格式如下：
```
:%s/旧文本/新文本/g
```
### 2)可视区域替换
- **先选中**要替换文字的**范围**
- 命令格式如下：

```
:s/旧文本/新文本/g
```
### 3)确认替换
- **如果把末尾的**`g`改成`gc`的时候，会有提示！**推荐使用**

```
:%s/旧文本/新文本/gc
```
1. `y`-`yes`替换
2. `n`-`no`不替换
3. `a`-`all`替换所有
4. `q`-`quit`退出替换
5. `l`-`last`最后一个，并把光标移动到行首
6. `^E`向下滚屏
7. `^Y`向上滚屏
## 4.11插入命令
- 在`vi`中除了常用的`i`进入**编辑模式**外，还提供了一下命令同样可以进入编辑模式：
|命令|英文|功能|常用| 
|---|---|---|---|
|i|insert|在当前字符前插入文本|常用|
|i|insert|在行首插入文本|较常用|
|a|append|在当前字符后添加文本||
|A|append|在行末添加文本|较常用|
|o||在当前行后面插入一空行|常用|
|O||在当前行前面插入一空行|常用|
![image](https://user-images.githubusercontent.com/12490550/157151560-99c81950-35eb-4993-bc66-47d7a28b1884.png)

